generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String?  // Hashed, optional if using NextAuth providers
  role      Role
  createdAt DateTime @default(now())
  documents Document[] @relation("Creator")
  partyBDocs Document[] @relation("PartyB")
  notaryDocs Document[] @relation("Notary")
  signatures Signature[]
  accounts  Account[]
}

enum Role {
  PARTY_A
  PARTY_B
  NOTARY
}

model Account {
  id                String  @id @default(uuid())
  userId            Int
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Document {
  id          Int        @id @default(autoincrement())
  title       String
  status      Status     @default(DRAFT)
  docusealId  String?
  version     Int        @default(1)
  creatorId   Int
  partyBId    Int?
  notaryId    Int?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  creator     User       @relation("Creator", fields: [creatorId], references: [id])
  partyB      User?      @relation("PartyB", fields: [partyBId], references: [id])
  notary      User?      @relation("Notary", fields: [notaryId], references: [id])
  signatures  Signature[]
  auditLogs   AuditLog[]
}

enum Status {
  DRAFT
  PENDING_PARTY_B
  PENDING_NOTARY
  COMPLETED
}

model Signature {
  id         Int      @id @default(autoincrement())
  documentId Int
  userId     Int
  type       String   // "drawn", "typed", "uploaded"
  ip         String?
  timestamp  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model AuditLog {
  id         Int      @id @default(autoincrement())
  documentId Int
  action     String
  details    String?
  ip         String?
  timestamp  DateTime @default(now())
  document   Document @relation(fields: [documentId], references: [id])
}